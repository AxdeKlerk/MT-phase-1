{% extends 'base.html' %}
{% load static %}

{% block title %}Tip: {{ artist.name }}{% endblock %}

{% block extra_head %}
    <script>window.STRIPE_PUBLIC_KEY = "{{ STRIPE_PUBLIC_KEY }}";</script>
{% endblock %}

{% block content %}

<div class="container-fluid w-100">
    <div class="row">
        <div class="col-12 title text-center">

            <!-- Header -->
            <h1>{{ venue.name }}</h1>
            <p>{{ gig_date|date:"d M Y" }}</p>
            <p class="fs-6">Artist gets 100% of your tip!</p>
            <p class="small text-muted">
                <a href="#" data-bs-toggle="modal" data-bs-target="#aboutModal" class="whats-this-link">
                    What's this?
                </a>
            </p>
        </div>

        <!-- Back Link -->
        <div class="text-left">
            <div class="back-btn">
                <a href="{% url 'gigs:date_page' venue.slug gig_date.year gig_date.month gig_date.day %}" class="link">← Back to Artist List for Today</a>
            </div>
        </div>
        <hr>
            <!-- Artist Logo -->
            <div class="artist-tip-row">
                <div class="artist-logo-tip-box">
                    {% include "gigs/artist_logo.html" with artist=gig.artist %}
                </div>
            </div>
            <h3 class="text-center">Tip {{ artist.name }}</h3>

            <!-- Amount buttons -->
            <div class="text-center">
                {% for amount in amounts %}
                    <button type="button" class="btn tip-btn" data-amount="{{ amount }}">£{{ amount }}</button>
                {% endfor %}
            </div>
            <hr>
        </div>
    </div>

    <div class="row" id="tip-section" data-gig-id="{{ gig.id }}"
        data-artist-name="{{ artist.name }}"
        data-amounts="{{ amounts|join:',' }}"
        data-start-url="{% url 'gigs:start_payment' %}"
        data-csrf="{{ csrf_token }}"> 
        <div class="col">
            <div class="tip-section text-center" 
                data-gig-id="{{ gig.id }}"
                data-cover-fees="{{ cover_processing_fees|yesno:'true,false' }}">

                <!-- Confirmation text -->
                <p id="tip-confirmation" class="text-center mt-3 d-none"></p>

                <!-- Clear option
                <button id="clear-tip" class="btn btn-link d-none">
                    Change amount
                </button> -->

                <!-- Stripe Card Element -->
                <div id="card-container" class="mt-4 d-none align-self-center">
                    <p>Please enter your card details</p>
                    <div class="mb-3">
                        <div id="card-number"></div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <div id="card-expiry"></div>
                        </div>
                        <div class="col-6">
                            <div id="card-cvc"></div>
                        </div>
                    </div>
                    <div id="wallet-button-container" class="mt-3"></div>
                    <div id="card-errors" class="text-danger mt-2"></div>
                </div>

                <!-- Pay button -->
                <button id="pay-btn" class="btn cta-btn mt-3" disabled>
                    Select an Amount to Tip
                </button>
                <p id="pay-confirmation" class="text-center"></p>

                <!-- Fee Message -->
                <p id="fee-message" class="text-center small mt-2 d-none">{{ fee_message|safe }}</p>
            </div>
        </div>
    </div>
</div>

{% endblock %}


